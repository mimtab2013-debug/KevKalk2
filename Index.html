<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>KevKalk Layplan Foto PRO</title>
<style>
body { margin:0; display:flex; font-family:Arial; }
.left { width:30%; padding:15px; background:#f2f2f2; height:100vh; overflow:auto;}
.right { width:70%; }
input, select { width:100%; margin-bottom:8px; padding:6px;}
button { width:100%; padding:10px; background:#0077cc; color:white; border:none; margin-top:5px;}
canvas { display:block; }
h3 { margin-top:15px;}
</style>
</head>
<body>

<div class="left">

<h3>Foto Upload</h3>
<input type="file" id="foto" accept="image/*">
<label>Referenzmaß (Hausbreite m)</label>
<input type="number" id="refMass">
<button onclick="ladeFoto()">Foto laden</button>

<h3>Haus Parameter</h3>
<label>Breite (m)</label>
<input type="number" id="breite">
<label>Länge (m)</label>
<input type="number" id="laenge">
<label>Traufhöhe (m)</label>
<input type="number" id="traufe">
<label>Firsthöhe (m)</label>
<input type="number" id="first">
<label>Dachüberstand (m)</label>
<input type="number" id="ueberstand">

<label>Dachform</label>
<select id="dach">
<option value="flat">Flachdach</option>
<option value="gable">Satteldach</option>
<option value="gableOver">Satteldach mit Überstand</option>
<option value="gableFront">Giebelhaus (wie Foto)</option>
<option value="hip">Walmdach</option>
<option value="pult">Pultdach</option>
</select>

<button onclick="bauen()">Haus generieren</button>

</div>

<div class="right" id="scene"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://threejs.org/examples/js/controls/OrbitControls.js"></script>

<script>

let scene = new THREE.Scene();
let camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 5000);
let renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth*0.7, window.innerHeight);
document.getElementById("scene").appendChild(renderer.domElement);

let controls = new THREE.OrbitControls(camera, renderer.domElement);
camera.position.set(30,20,40);
controls.update();

scene.add(new THREE.AmbientLight(0xffffff,0.8));
let light = new THREE.DirectionalLight(0xffffff,0.6);
light.position.set(20,50,20);
scene.add(light);

let backgroundMesh;

function ladeFoto(){

let file = document.getElementById("foto").files[0];
if(!file) return;

let reader = new FileReader();
reader.onload = function(e){

let texture = new THREE.TextureLoader().load(e.target.result);

let plane = new THREE.PlaneGeometry(20,12);
let material = new THREE.MeshBasicMaterial({map:texture});
backgroundMesh = new THREE.Mesh(plane, material);

backgroundMesh.position.set(0,6,-20);
scene.add(backgroundMesh);

}
reader.readAsDataURL(file);
}

function clearScene(){
while(scene.children.length > 2){
scene.remove(scene.children[2]);
}
}

function bauen(){

clearScene();

let breite = parseFloat(document.getElementById("breite").value)||10;
let laenge = parseFloat(document.getElementById("laenge").value)||10;
let traufe = parseFloat(document.getElementById("traufe").value)||6;
let first = parseFloat(document.getElementById("first").value)||8;
let ueber = parseFloat(document.getElementById("ueberstand").value)||0.5;
let dach = document.getElementById("dach").value;

let hausMat = new THREE.MeshPhongMaterial({color:0xdddddd});
let roofMat = new THREE.MeshPhongMaterial({color:0xaa0000});

let body = new THREE.Mesh(
new THREE.BoxGeometry(breite, traufe, laenge),
hausMat
);
body.position.set(0,traufe/2,0);
scene.add(body);

if(dach=="flat") return;

if(dach=="gable" || dach=="gableOver" || dach=="gableFront"){

let roofWidth = breite + (dach!="gable"? ueber*2:0);

let roof = new THREE.Mesh(
new THREE.ConeGeometry(roofWidth/2, first-traufe, 4),
roofMat
);

roof.rotation.y = Math.PI/4;
roof.position.set(0,traufe+(first-traufe)/2,0);
scene.add(roof);

}

if(dach=="hip"){
let roof = new THREE.Mesh(
new THREE.ConeGeometry(breite/2, first-traufe, 4),
roofMat
);
roof.position.set(0,traufe+(first-traufe)/2,0);
scene.add(roof);
}

if(dach=="pult"){
let roof = new THREE.Mesh(
new THREE.BoxGeometry(breite, first-traufe, laenge),
roofMat
);
roof.position.set(0,traufe+(first-traufe)/2,0);
scene.add(roof);
}

}

function animate(){
requestAnimationFrame(animate);
renderer.render(scene,camera);
}
animate();

</script>

</body>
</html>
